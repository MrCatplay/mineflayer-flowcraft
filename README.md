# FlowCraft — сценарный движок для Mineflayer на основе draw.io

[![Node.js](https://img.shields.io/badge/Node.js-16+-green.svg)](https://nodejs.org/)
[![Mineflayer](https://img.shields.io/badge/Mineflayer-4.x-blue.svg)](https://github.com/PrismarineJS/mineflayer)
[![draw.io](https://img.shields.io/badge/draw.io-Diagrams-orange.svg)](https://github.com/jgraph/drawio)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

## Обзор
FlowCraft позволяет управлять ботом через блок‑схемы [draw.io](https://github.com/jgraph/drawio): события запускают цепочки действий, поддерживаются ветвления, циклы и переменные. Бот работает на базе [Mineflayer](https://github.com/PrismarineJS/mineflayer), что обеспечивает стабильный высокоуровневый API.

## Возможности
- Сценарии из диаграмм draw.io
- События: появление/смерть бота, открытие/закрытие окон и др.
- Цепочки действий с условиями (ДА/НЕТ), циклами и задержками
- Команды бота (инвентарь, хотбар, чат, действия)
- Переменные (создание, арифметика, подстановка в сообщения)
- Расширяемая система команд (классы от BaseCommand)

## Требования
- Node.js LTS (16+)

## Установка
```bash
npm i
```

## Пример запуска (как библиотека)
```js
const mineflayer = require('mineflayer');
const { FlowCraft } = require('flowcraft');

// Создаём оффлайн-бота (без подключения к серверу)
const bot = mineflayer.createBot({
  host: 'localhost',
  port: 25565,
  username: 'FlowBot',
  version: '1.19.2'
});

// Подключаем FlowCraft
new FlowCraft(bot, { scriptPath: 'script.drawio' });
```

## Как это работает
1. При логине бот читает `script.drawio`, извлекает «облака» (переменные) и сохраняет в `bot.variable`.
2. События (например, «Бот появился», «Бот умер», «Инвентарь открыт/закрыт») ищутся в диаграмме и превращаются в цепочку действий.
3. Цепочка исполняется последовательно:
   - строки интерпретируются как команды;
   - поддерживаются задержки вида `кд: 1000` (мс);
   - условия `если: ...` с ветками `ДА/НЕТ`;
   - повторы `повторить: N` и `повторить: бесконечно`.

> В бесконечных циклах обязательно используйте `кд:` внутри тела, чтобы не перегружать сервер.

## Диаграммы draw.io
- Событие задаётся узлом с текстом, содержащим название события (например, `Бот появился`).
- Рёбра без подписи — переход по цепочке.
- Узлы со значениями:
  - команды (см. ниже);
  - условие: `если: var == value` → дальше узлы `ДА` и `НЕТ`;
  - цикл: `повторить: N` или `повторить: бесконечно`;
  - задержка: `кд: 1000` (мс).
- Облака (shape=cloud) для переменных: `имя = значение`.

## Команды (по умолчанию)
- Базовые:
  - `выключить`
  - `сесть`
  - `встать`
  - `пкм`
  - `кд: 1000` — задержка в мс (внутренняя служебная команда)
- Инвентарь и хотбар:
  - `слот: <number>` — клик по слоту
  - `хотбар: <0..8>` — выбор слота хотбара
  - `закрыть инвентарь`
- Чат:
  - Любая другая строка отправляется в чат, с подстановкой переменных вида `{name}`

## Переменные
- Объявление в облаках: `name = value`
- Арифметика:
  - `name ++ number`
  - `name -- number`
  - `name ** number`
  - `name // number`
- Подстановка в сообщениях: `Привет, {name}!`

## Примечания
- Для стабильной работы с бесконечными циклами добавляйте `кд:` внутри тела цикла.
